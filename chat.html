<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>Менің Чатым</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; background: #e5ddd5; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; }
        .msg { background: white; padding: 10px; border-radius: 10px; margin-bottom: 10px; max-width: 70%; width: fit-content; }
        .my-msg { background: #dcf8c6; align-self: flex-end; }
        .input-area { background: #f0f0f0; padding: 15px; display: flex; }
        input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 20px; outline: none; }
        button { margin-left: 10px; padding: 10px 20px; background: #075e54; color: white; border: none; border-radius: 20px; cursor: pointer; }
        .user-name { font-weight: bold; font-size: 0.8em; color: #555; display: block; }
    </style>
</head>
<body>

<div id="chat-box"></div>

<div class="input-area">
    <input type="text" id="m" placeholder="Хабарлама жазыңыз...">
    <button onclick="send()">Жіберу</button>
</div>

<script>
    const socket = io();
    const chatBox = document.getElementById('chat-box');
    const username = localStorage.getItem('username') || 'Қонақ';

    // Чат бөлмесіне қосылу
    socket.emit('join', { room: 'main', user: username });

    // Хабарлама жіберу
    function send() {
        const input = document.getElementById('m');
        if (input.value.trim() !== "") {
            socket.emit('message', { room: 'main', user: username, text: input.value });
            input.value = '';
        }
    }

    // Хабарламаны қабылдау және экранға шығару
    socket.on('msg', (data) => {
        const div = document.createElement('div');
        div.classList.add('msg');
        if (data.user === username) div.classList.add('my-msg');
        
        div.innerHTML = `<span class="user-name">${data.user}</span>${data.text}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight; // Автоматты түрде төмен түсу
    });

    // Enter басса да жіберу
    document.getElementById('m').addEventListener("keypress", (e) => {
        if (e.key === "Enter") send();
    });
</script>

</body>
</html>