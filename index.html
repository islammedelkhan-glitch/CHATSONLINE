<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>Messenger - Кіру</title>
    <style>
        body { background: #0b141a; color: white; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .auth-box { background: #111b21; padding: 40px; border-radius: 15px; width: 320px; text-align: center; border: 1px solid #222d32; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #2a3942; color: white; outline: none; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; background: #00a884; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .toggle { margin-top: 15px; font-size: 14px; color: #8696a0; cursor: pointer; }
    </style>
</head>
<body>
    <div class="auth-box">
        <h2 id="title">Кіру</h2>
        <input type="text" id="user" placeholder="Логин">
        <input type="password" id="pass" placeholder="Құпия сөз">
        <button type="button" onclick="authAction()">Растау</button>
        <div class="toggle" onclick="switchMode()" id="toggle-text">Аккаунт жасау</div>
    </div>

    <script>
        let isLogin = true;
        function switchMode() {
            isLogin = !isLogin;
            document.getElementById('title').innerText = isLogin ? "Кіру" : "Тіркелу";
            document.getElementById('toggle-text').innerText = isLogin ? "Аккаунт жасау" : "Кіруге қайту";
        }

        async function authAction() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            if (!u || !p) return alert("Толтырыңыз!");

            const url = isLogin ? '/login' : '/register';
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                if(data.success) {
                    if(isLogin) {
                        localStorage.setItem('username', u);
                        window.location.href = 'chat.html';
                    } else {
                        alert("Сәтті тіркелдіңіз! Енді кіріңіз.");
                        switchMode();
                    }
                } else { alert("Қате: Логин немесе пароль дұрыс емес!"); }
            } catch(e) { alert("Сервермен байланыс жоқ!"); }
        }
    </script>
</body>
</html>